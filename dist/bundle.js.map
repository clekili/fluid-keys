{"version":3,"sources":["webpack:///webpack/bootstrap c2dc1e1f413e9b7a2aa2","webpack:///./lib/entry.js","webpack:///./lib/fluidSimulator.js","webpack:///./lib/fluidSolver.js","webpack:///./lib/fluidBox.js","webpack:///./lib/fluidBoxRenderer.js"],"names":["document","addEventListener","width","getElementById","offsetWidth","height","offsetHeight","resolution","parseInt","value","density","iterations","viscosity","parseFloat","diffusion","simulator","FluidSimulator","startPos","currentPos","mouseIsDown","simulating","solver","setUI","ui","bind","canvas","initCanvas","initControlPanel","renderer","i","update","render","$viscCtrl","$","change","setViscosity","e","target","$diffusionCtrl","setDiffusion","$resolutionCtrl","$iterationsCtrl","setIterations","$densityCtrl","get","ontouchend","onmouseup","mouseUpHandler","ontouchstart","onmousedown","mouseDownHandler","ontouchmove","onmousemove","mouseMoveHandler","preventDefault","getMousePos","setInterval","posX","clientX","offsetLeft","posY","clientY","offsetTop","fluidBox","startX","startY","currentX","currentY","inCanvas","dx","dy","d","Math","sqrt","x","floor","y","setVelocity","setDensity","pos","iter","dt","N","systemSize","addSource","s","IX","j","setBoundary","b","gaussSeidel","x0","diff","a","k","neighborSum","diffuse","advect","d0","u","v","s0","t0","s1","t1","i0","i1","j0","j1","project","p","div","densityStep","velocityStep","u0","v0","visc","FluidSolver","Array","fill","timeStep","callback","FluidBox","size","length","vX","vY","FluidBoxRenderer","ctx","getContext","imageData","createImageData","data","densify","beginPath","rect","fillStyle","textAlign","font","fillText","getImageData","pixel","getDensity","putImageData"],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAe;AACf;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;;ACtCA;;;;;;AAEAA,UAASC,gBAAT,CAA0B,kBAA1B,EAA8C,YAAU;AACtD,OAAIC,QAAQF,SAASG,cAAT,CAAwB,gBAAxB,EAA0CC,WAAtD;AACA,OAAIC,SAASL,SAASG,cAAT,CAAwB,gBAAxB,EAA0CG,YAAvD;AACA,OAAIC,aAAaC,SAASR,SAASG,cAAT,CAAwB,YAAxB,EAAsCM,KAA/C,CAAjB;AACA,OAAIC,UAAUF,SAASR,SAASG,cAAT,CAAwB,SAAxB,EAAmCM,KAA5C,CAAd;AACA,OAAIE,aAAaH,SAASR,SAASG,cAAT,CAAwB,YAAxB,EAAsCM,KAA/C,CAAjB;AACA,OAAIG,YAAYC,WAAWb,SAASG,cAAT,CAAwB,WAAxB,EAAqCM,KAAhD,CAAhB;AACA,OAAIK,YAAYD,WAAWb,SAASG,cAAT,CAAwB,WAAxB,EAAqCM,KAAhD,CAAhB;AACA,OAAIM,YAAY,6BAAmBb,KAAnB,EAA0BG,MAA1B,EAAkCE,UAAlC,EAA8CG,OAA9C,EAAuDI,SAAvD,EAAkEF,SAAlE,EAA6ED,UAA7E,CAAhB;AACD,EATD,E;;;;;;;;;;;;;;ACFA;;;;AACA;;;;;;;;KAEMK,c;AAEJ,2BAAYd,KAAZ,EAAmBG,MAAnB,EAA2BE,UAA3B,EAAuCG,OAAvC,EAAgDI,SAAhD,EAA2DF,SAA3D,EAAsED,UAAtE,EAAiF;AAAA;;AAC/E,UAAKT,KAAL,GAAaA,KAAb;AACA,UAAKG,MAAL,GAAcA,MAAd;AACA,UAAKE,UAAL,GAAkBA,UAAlB;AACA,UAAKG,OAAL,GAAeA,WAAW,EAA1B;;AAEA,UAAKO,QAAL,GAAgB,CAAC,CAAD,EAAI,CAAJ,CAAhB;AACA,UAAKC,UAAL,GAAkB,CAAC,CAAD,EAAI,CAAJ,CAAlB;AACA,UAAKC,WAAL,GAAmB,KAAnB;AACA,UAAKC,UAAL,GAAkB,KAAlB;;AAEA,UAAKC,MAAL,GAAc,0BAAgBd,UAAhB,EAA4BI,UAA5B,EAAwCC,SAAxC,EAAmDE,SAAnD,CAAd;AACA,UAAKO,MAAL,CAAYC,KAAZ,CAAkB,KAAKC,EAAL,CAAQC,IAAR,CAAa,IAAb,CAAlB;;AAEA,UAAKC,MAAL,GAAc,KAAKC,UAAL,EAAd;AACA,UAAKC,gBAAL;AACA,UAAKC,QAAL,GAAgB,+BAAqB,KAAKH,MAA1B,EAAkC,KAAKJ,MAAvC,CAAhB;;AAEA,UAAI,IAAIQ,IAAI,CAAZ,EAAeA,IAAI,EAAnB,EAAuBA,GAAvB;AACE,YAAKC,MAAL;AADF;AAED;;;;8BAEO;AACN,YAAKT,MAAL,CAAYS,MAAZ;AACA,YAAKF,QAAL,CAAcG,MAAd;AACD;;;wCAEiB;AAAA;;AAChB,WAAIC,YAAYC,EAAE,YAAF,CAAhB;AACAD,iBAAUE,MAAV,CAAkB,aAAK;AACrB,eAAKb,MAAL,CAAYc,YAAZ,CAAyBtB,WAAWuB,EAAEC,MAAF,CAAS5B,KAApB,CAAzB;AACD,QAFD;;AAIA,WAAI6B,iBAAiBL,EAAE,YAAF,CAArB;AACAK,sBAAeJ,MAAf,CAAuB,aAAK;AAC1B,eAAKb,MAAL,CAAYkB,YAAZ,CAAyB1B,WAAWuB,EAAEC,MAAF,CAAS5B,KAApB,CAAzB;AACD,QAFD;;AAIA,WAAI+B,kBAAkBP,EAAE,aAAF,CAAtB;AACAO,uBAAgBN,MAAhB,CAAwB,aAAK;AAC3B,eAAKd,UAAL,GAAkB,KAAlB;AACA,eAAKb,UAAL,GAAkBC,SAAS4B,EAAEC,MAAF,CAAS5B,KAAlB,CAAlB;AACA,eAAKY,MAAL,GAAc,0BAAgB,MAAKd,UAArB,CAAd;;AAEA,eAAKc,MAAL,CAAYC,KAAZ,CAAkB,MAAKC,EAAL,CAAQC,IAAR,OAAlB;AACA,eAAKC,MAAL,GAAc,MAAKC,UAAL,EAAd;AACA,eAAKE,QAAL,GAAgB,+BAAqB,MAAKH,MAA1B,EAAkC,MAAKJ,MAAvC,CAAhB;AACD,QARD;;AAUA,WAAIoB,kBAAkBR,EAAE,aAAF,CAAtB;AACAQ,uBAAgBP,MAAhB,CAAwB,aAAK;AAC3B,eAAKb,MAAL,CAAYqB,aAAZ,CAA0BlC,SAAS4B,EAAEC,MAAF,CAAS5B,KAAlB,CAA1B;AACD,QAFD;;AAIA,WAAIkC,eAAeV,EAAE,UAAF,CAAnB;AACAU,oBAAaT,MAAb,CAAqB,aAAK;AACxB,eAAKxB,OAAL,GAAeF,SAAS4B,EAAEC,MAAF,CAAS5B,KAAlB,CAAf;AACD,QAFD;AAID;;;kCAEW;AACV,WAAIgB,SAASQ,EAAE,iBAAF,EAAqBW,GAArB,CAAyB,CAAzB,CAAb;;AAEAnB,cAAOvB,KAAP,GAAeuB,OAAOpB,MAAP,GAAgB,KAAKE,UAApC;AACAkB,cAAOoB,UAAP,GAAoBpB,OAAOqB,SAAP,GAAmB,KAAKC,cAAL,CAAoBvB,IAApB,CAAyB,IAAzB,CAAvC;AACAC,cAAOuB,YAAP,GAAsBvB,OAAOwB,WAAP,GAAqB,KAAKC,gBAAL,CAAsB1B,IAAtB,CAA2B,IAA3B,CAA3C;AACAC,cAAO0B,WAAP,GAAqB1B,OAAO2B,WAAP,GAAqB,KAAKC,gBAAL,CAAsB7B,IAAtB,CAA2B,IAA3B,CAA1C;;AAEA,cAAOC,MAAP;AACD;;;sCAEgBW,C,EAAE;AACjBA,SAAEkB,cAAF;AACA,YAAKrC,QAAL,GAAgB,KAAKC,UAAL,GAAkB,KAAKqC,WAAL,CAAiBnB,CAAjB,CAAlC;AACA,YAAKjB,WAAL,GAAmB,IAAnB;;AAEA,WAAG,CAAC,KAAKC,UAAT,EAAoB;AAClB,cAAKA,UAAL,GAAkB,IAAlB;AACAoC,qBAAY,KAAK1B,MAAL,CAAYN,IAAZ,CAAiB,IAAjB,CAAZ,EAAoC,EAApC;AACD;AACF;;;sCAEgBY,C,EAAE;AACjBA,SAAEkB,cAAF;AACA,YAAKpC,UAAL,GAAkB,KAAKqC,WAAL,CAAiBnB,CAAjB,CAAlB;AACD;;;oCAEcA,C,EAAE;AACfA,SAAEkB,cAAF;AACA,YAAKnC,WAAL,GAAmB,KAAnB;AACD;;;iCAEWiB,C,EAAE;AACZ,WAAIqB,OAAOrB,EAAEsB,OAAF,GAAY,KAAKjC,MAAL,CAAYkC,UAAnC;AACA,WAAIC,OAAOxB,EAAEyB,OAAF,GAAY,KAAKpC,MAAL,CAAYqC,SAAnC;AACA,cAAO,CAACL,IAAD,EAAOG,IAAP,CAAP;AACD;;;wBAEEG,Q,EAAS;AACV,WAAIC,SAAS,KAAK/C,QAAL,CAAc,CAAd,CAAb;AACA,WAAIgD,SAAS,KAAKhD,QAAL,CAAc,CAAd,CAAb;AACA,WAAIiD,WAAW,KAAKhD,UAAL,CAAgB,CAAhB,CAAf;AACA,WAAIiD,WAAW,KAAKjD,UAAL,CAAgB,CAAhB,CAAf;;AAEA,WAAG,KAAKkD,QAAL,CAAc,KAAKnD,QAAnB,KAAgC,KAAKE,WAAxC,EAAoD;AAClD,aAAIkD,KAAKH,WAAWF,MAApB;AACA,aAAIM,KAAKH,WAAWF,MAApB;AACA,aAAIM,IAAIC,KAAKC,IAAL,CAAUJ,KAAKA,EAAL,GAAUC,KAAKA,EAAzB,KAAgC,CAAxC;;AAEA,cAAI,IAAIzC,IAAI,CAAZ,EAAeA,IAAI0C,CAAnB,EAAsB1C,GAAtB,EAA0B;AACxB,eAAI6C,IAAIF,KAAKG,KAAL,CAAW,CAACX,SAASK,MAAMxC,IAAI0C,CAAV,CAAV,IAA0BR,SAAS7D,KAAT,EAA1B,GAA6C,KAAKA,KAA7D,CAAR;AACA,eAAI0E,IAAIJ,KAAKG,KAAL,CAAW,CAACV,SAASK,MAAMzC,IAAI0C,CAAV,CAAV,IAA0BR,SAAS1D,MAAT,EAA1B,GAA8C,KAAKA,MAA9D,CAAR;;AAEA0D,oBAASc,WAAT,CAAqBH,CAArB,EAAwBE,CAAxB,EAA2BP,EAA3B,EAA+BC,EAA/B;AACAP,oBAASe,UAAT,CAAoBJ,CAApB,EAAuBE,CAAvB,EAA0B,KAAKlE,OAA/B;AACD;;AAED,cAAKO,QAAL,GAAgB,CAACiD,QAAD,EAAWC,QAAX,CAAhB;AACD;AACF;;;8BAEQY,G,EAAI;AACX,cAAOA,IAAI,CAAJ,KAAU,CAAV,IAAeA,IAAI,CAAJ,IAAS,KAAK7E,KAA7B,IAAsC6E,IAAI,CAAJ,KAAU,CAAhD,IAAqDA,IAAI,CAAJ,IAAS,KAAK1E,MAA1E;AACD;;;;;;mBAGYW,c;;;;;;;;;;;;;;ACpIf;;;;;;;;AAEA,KAAIgE,OAAO,EAAX;AACA,KAAIC,KAAK,GAAT;AACA,KAAIC,IAAI,GAAR;AACA,KAAIC,aAAa,CAACD,IAAE,CAAH,KAASA,IAAE,CAAX,CAAjB;;AAEA,UAASE,SAAT,CAAmBV,CAAnB,EAAsBW,CAAtB,EAAwB;AACpB,QAAI,IAAIxD,IAAI,CAAZ,EAAeA,IAAIsD,UAAnB,EAA+BtD,GAA/B;AAAoC6C,OAAE7C,CAAF,KAAQoD,KAAKI,EAAExD,CAAF,CAAb;AAApC;AACH;;AAED,UAASyD,EAAT,CAAYzD,CAAZ,EAAe0D,CAAf,EAAiB;AACf,UAAO1D,IAAI,CAACqD,IAAI,CAAL,IAAUK,CAArB;AACD;;AAED,UAASC,WAAT,CAAqBC,CAArB,EAAwBf,CAAxB,EAA0B;AACxB,QAAI,IAAI7C,IAAI,CAAZ,EAAeA,KAAKqD,CAApB,EAAwBrD,GAAxB,EAA4B;AAC1B6C,OAAEY,GAAG,CAAH,EAAMzD,CAAN,CAAF,IAAiB4D,MAAM,CAAN,GAAU,CAACf,EAAEY,GAAG,CAAH,EAAMzD,CAAN,CAAF,CAAX,GAAyB6C,EAAEY,GAAG,CAAH,EAAMzD,CAAN,CAAF,CAA1C;AACA6C,OAAEY,GAAGJ,IAAE,CAAL,EAAQrD,CAAR,CAAF,IAAiB4D,MAAM,CAAN,GAAU,CAACf,EAAEY,GAAGJ,CAAH,EAAMrD,CAAN,CAAF,CAAX,GAAyB6C,EAAEY,GAAGJ,CAAH,EAAMrD,CAAN,CAAF,CAA1C;AACA6C,OAAEY,GAAGzD,CAAH,EAAM,CAAN,CAAF,IAAiB4D,MAAM,CAAN,GAAU,CAACf,EAAEY,GAAGzD,CAAH,EAAM,CAAN,CAAF,CAAX,GAAyB6C,EAAEY,GAAGzD,CAAH,EAAM,CAAN,CAAF,CAA1C;AACA6C,OAAEY,GAAGzD,CAAH,EAAMqD,IAAE,CAAR,CAAF,IAAiBO,MAAM,CAAN,GAAU,CAACf,EAAEY,GAAGzD,CAAH,EAAMqD,CAAN,CAAF,CAAX,GAAyBR,EAAEY,GAAGzD,CAAH,EAAMqD,CAAN,CAAF,CAA1C;AACD;;AAEDR,KAAEY,GAAG,CAAH,EAAM,CAAN,CAAF,IAAoB,OAAOZ,EAAEY,GAAG,CAAH,EAAM,CAAN,CAAF,IAAcZ,EAAEY,GAAG,CAAH,EAAM,CAAN,CAAF,CAArB,CAApB;AACAZ,KAAEY,GAAG,CAAH,EAAMJ,IAAE,CAAR,CAAF,IAAoB,OAAOR,EAAEY,GAAG,CAAH,EAAMJ,IAAE,CAAR,CAAF,IAAgBR,EAAEY,GAAG,CAAH,EAAMJ,CAAN,CAAF,CAAvB,CAApB;AACAR,KAAEY,GAAGJ,IAAE,CAAL,EAAQ,CAAR,CAAF,IAAoB,OAAOR,EAAEY,GAAGJ,CAAH,EAAM,CAAN,CAAF,IAAcR,EAAEY,GAAGJ,IAAE,CAAL,EAAQ,CAAR,CAAF,CAArB,CAApB;AACAR,KAAEY,GAAGJ,IAAE,CAAL,EAAQA,IAAE,CAAV,CAAF,IAAoB,OAAOR,EAAEY,GAAGJ,CAAH,EAAMA,IAAE,CAAR,CAAF,IAAgBR,EAAEY,GAAGJ,IAAE,CAAL,EAAQA,CAAR,CAAF,CAAvB,CAApB;;AAEA,UAAOR,CAAP;AACD;;AAED,UAASgB,WAAT,CAAqBD,CAArB,EAAwBf,CAAxB,EAA2BiB,EAA3B,EAA+BC,IAA/B,EAAoC;AAClC,OAAIC,IAAIZ,KAAKW,IAAb;;AAEA,QAAI,IAAIE,IAAI,CAAZ,EAAeA,IAAId,IAAnB,EAAyBc,GAAzB,EAA6B;AAC3B,UAAI,IAAIjE,IAAI,CAAZ,EAAeA,KAAKqD,CAApB,EAAuBrD,GAAvB,EAA2B;AACzB,YAAI,IAAI0D,IAAI,CAAZ,EAAeA,KAAKL,CAApB,EAAuBK,GAAvB,EAA2B;AACzB,aAAIQ,cAAcrB,EAAEY,GAAGzD,IAAE,CAAL,EAAQ0D,CAAR,CAAF,IAAgBb,EAAEY,GAAGzD,IAAE,CAAL,EAAQ0D,CAAR,CAAF,CAAhB,GAAgCb,EAAEY,GAAGzD,CAAH,EAAM0D,IAAE,CAAR,CAAF,CAAhC,GAAgDb,EAAEY,GAAGzD,CAAH,EAAM0D,IAAE,CAAR,CAAF,CAAlE;AACAb,WAAEY,GAAGzD,CAAH,EAAM0D,CAAN,CAAF,IAAc,CAACI,GAAGL,GAAGzD,CAAH,EAAM0D,CAAN,CAAH,IAAeM,IAAIE,WAApB,KAAoC,IAAI,IAAIF,CAA5C,CAAd;AACD;AACF;AACDL,iBAAYC,CAAZ,EAAef,CAAf;AACD;AACF;;AAED,UAASsB,OAAT,CAAiBP,CAAjB,EAAoBf,CAApB,EAAuBiB,EAAvB,EAA2BC,IAA3B,EAAgC;AAC5BF,eAAYD,CAAZ,EAAef,CAAf,EAAkBiB,EAAlB,EAAsBC,IAAtB;AACH;;AAED,UAASK,MAAT,CAAgBR,CAAhB,EAAmBlB,CAAnB,EAAsB2B,EAAtB,EAA0BC,CAA1B,EAA6BC,CAA7B,EAA+B;AAC7B,OAAI1B,UAAJ;AAAA,OAAOE,UAAP;AAAA,OAAUyB,WAAV;AAAA,OAAcC,WAAd;AAAA,OAAkBC,WAAlB;AAAA,OAAsBC,WAAtB;AAAA,OAA0BC,WAA1B;AAAA,OAA8BC,WAA9B;AAAA,OAAkCC,WAAlC;AAAA,OAAsCC,WAAtC;;AAEA,QAAI,IAAI/E,IAAI,CAAZ,EAAeA,KAAKqD,CAApB,EAAuBrD,GAAvB,EAA2B;AACvB,UAAI,IAAI0D,IAAI,CAAZ,EAAeA,KAAKL,CAApB,EAAuBK,GAAvB,EAA2B;AACvBb,WAAI7C,IAAIqD,IAAID,EAAJ,GAASkB,EAAEb,GAAGzD,CAAH,EAAM0D,CAAN,CAAF,CAAjB;AACAX,WAAIW,IAAIL,IAAID,EAAJ,GAASmB,EAAEd,GAAGzD,CAAH,EAAM0D,CAAN,CAAF,CAAjB;;AAEA,WAAIb,IAAI,GAAR,EACIA,IAAI,GAAJ,CADJ,KAEK,IAAIA,IAAIQ,IAAI,GAAZ,EACDR,IAAIQ,IAAI,GAAR;AACJuB,YAAKjC,KAAKG,KAAL,CAAWD,CAAX,CAAL;AACAgC,YAAKD,KAAK,CAAV;;AAEA,WAAI7B,IAAI,GAAR,EACIA,IAAI,GAAJ,CADJ,KAEK,IAAIA,IAAIM,IAAI,GAAZ,EACDN,IAAIM,IAAI,GAAR;AACJyB,YAAKnC,KAAKG,KAAL,CAAWC,CAAX,CAAL;AACAgC,YAAKD,KAAK,CAAV;;AAEAJ,YAAK7B,IAAI+B,EAAT;AACAJ,YAAK,IAAIE,EAAT;AACAC,YAAK5B,IAAI+B,EAAT;AACAL,YAAK,IAAIE,EAAT;;AAEAjC,SAAEe,GAAGzD,CAAH,EAAM0D,CAAN,CAAF,IAAcc,MAAMC,KAAKJ,GAAGZ,GAAGmB,EAAH,EAAOE,EAAP,CAAH,CAAL,GAAsBH,KAAKN,GAAGZ,GAAGmB,EAAH,EAAOG,EAAP,CAAH,CAAjC,IAAmDL,MAAMD,KAAKJ,GAAGZ,GAAGoB,EAAH,EAAOC,EAAP,CAAH,CAAL,GAAsBH,KAAKN,GAAGZ,GAAGoB,EAAH,EAAOE,EAAP,CAAH,CAAjC,CAAjE;AACH;AACJ;AACDpB,eAAYC,CAAZ,EAAelB,CAAf;AACD;;AAED,UAASsC,OAAT,CAAiBV,CAAjB,EAAoBC,CAApB,EAAuBU,CAAvB,EAA0BC,GAA1B,EAA8B;AAC1B,QAAI,IAAIxB,IAAI,CAAZ,EAAeA,KAAKL,CAApB,EAAuBK,GAAvB,EAA2B;AACvB,UAAI,IAAI1D,IAAI,CAAZ,EAAeA,KAAKqD,CAApB,EAAuBrD,GAAvB,EAA2B;AACzB,WAAIkE,cAAcI,EAAEb,GAAGzD,IAAE,CAAL,EAAQ0D,CAAR,CAAF,IAAgBY,EAAEb,GAAGzD,IAAE,CAAL,EAAQ0D,CAAR,CAAF,CAAhB,GAAgCa,EAAEd,GAAGzD,CAAH,EAAM0D,IAAE,CAAR,CAAF,CAAhC,GAAgDa,EAAEd,GAAGzD,CAAH,EAAM0D,IAAE,CAAR,CAAF,CAAlE;AACAwB,WAAIzB,GAAGzD,CAAH,EAAM0D,CAAN,CAAJ,IAAgB,CAAC,GAAD,GAAOQ,WAAP,GAAqBb,CAArC;;AAEA4B,SAAExB,GAAGzD,CAAH,EAAM0D,CAAN,CAAF,IAAc,CAAd;AACD;AACJ;AACDC,eAAY,CAAZ,EAAeuB,GAAf;AACAvB,eAAY,CAAZ,EAAesB,CAAf;;AAEA,QAAI,IAAIhB,IAAI,CAAZ,EAAeA,IAAId,IAAnB,EAAyBc,GAAzB,EAA6B;AAC3B,UAAI,IAAIjE,KAAI,CAAZ,EAAeA,MAAKqD,CAApB,EAAuBrD,IAAvB,EAA2B;AACzB,YAAI,IAAI0D,KAAI,CAAZ,EAAeA,MAAKL,CAApB,EAAuBK,IAAvB,EAA2B;AACzB,aAAIQ,eAAce,EAAExB,GAAGzD,KAAE,CAAL,EAAQ0D,EAAR,CAAF,IAAgBuB,EAAExB,GAAGzD,KAAE,CAAL,EAAQ0D,EAAR,CAAF,CAAhB,GAAgCuB,EAAExB,GAAGzD,EAAH,EAAM0D,KAAE,CAAR,CAAF,CAAhC,GAAgDuB,EAAExB,GAAGzD,EAAH,EAAM0D,KAAE,CAAR,CAAF,CAAlE;AACAuB,WAAExB,GAAGzD,EAAH,EAAM0D,EAAN,CAAF,IAAc,CAACwB,IAAIzB,GAAGzD,EAAH,EAAM0D,EAAN,CAAJ,IAAgBQ,YAAjB,IAAgC,CAA9C;AACD;AACF;AACDP,iBAAY,CAAZ,EAAesB,CAAf;AACD;AACDtB,eAAY,CAAZ,EAAesB,CAAf;;AAEA,QAAI,IAAIvB,MAAI,CAAZ,EAAeA,OAAKL,CAApB,EAAuBK,KAAvB,EAA2B;AACvB,UAAI,IAAI1D,MAAI,CAAZ,EAAeA,OAAKqD,CAApB,EAAuBrD,KAAvB,EAA2B;AACvBsE,SAAEb,GAAGzD,GAAH,EAAM0D,GAAN,CAAF,KAAe,MAAML,CAAN,IAAW4B,EAAExB,GAAGzD,MAAE,CAAL,EAAQ0D,GAAR,CAAF,IAAgBuB,EAAExB,GAAGzD,MAAE,CAAL,EAAQ0D,GAAR,CAAF,CAA3B,CAAf;AACAa,SAAEd,GAAGzD,GAAH,EAAM0D,GAAN,CAAF,KAAe,MAAML,CAAN,IAAW4B,EAAExB,GAAGzD,GAAH,EAAM0D,MAAE,CAAR,CAAF,IAAgBuB,EAAExB,GAAGzD,GAAH,EAAM0D,MAAE,CAAR,CAAF,CAA3B,CAAf;AACH;AACJ;AACDC,eAAY,CAAZ,EAAeW,CAAf;AACAX,eAAY,CAAZ,EAAeY,CAAf;AACH;;AAED,UAASY,WAAT,CAAqBtC,CAArB,EAAwBiB,EAAxB,EAA4BQ,CAA5B,EAA+BC,CAA/B,EAAkCR,IAAlC,EAAuC;AACnCR,aAAUV,CAAV,EAAaiB,EAAb;AACAK,WAAQ,CAAR,EAAWL,EAAX,EAAejB,CAAf,EAAkBkB,IAAlB;AACAK,UAAO,CAAP,EAAUvB,CAAV,EAAaiB,EAAb,EAAiBQ,CAAjB,EAAoBC,CAApB;AACH;;AAED,UAASa,YAAT,CAAsBd,CAAtB,EAAyBC,CAAzB,EAA4Bc,EAA5B,EAAgCC,EAAhC,EAAoCC,IAApC,EAAyC;AACrChC,aAAUe,CAAV,EAAae,EAAb;AACA9B,aAAUgB,CAAV,EAAae,EAAb;;AAEAnB,WAAQ,CAAR,EAAWkB,EAAX,EAAef,CAAf,EAAkBiB,IAAlB;AACApB,WAAQ,CAAR,EAAWmB,EAAX,EAAef,CAAf,EAAkBgB,IAAlB;AACAP,WAAQK,EAAR,EAAYC,EAAZ,EAAgBhB,CAAhB,EAAmBC,CAAnB;;AAEAH,UAAO,CAAP,EAAUE,CAAV,EAAae,EAAb,EAAiBA,EAAjB,EAAqBC,EAArB;AACAlB,UAAO,CAAP,EAAUG,CAAV,EAAae,EAAb,EAAiBD,EAAjB,EAAqBC,EAArB;AACAN,WAAQV,CAAR,EAAWC,CAAX,EAAcc,EAAd,EAAkBC,EAAlB;AACH;;KAEKE,W;AACF,wBAAY9G,UAAZ,EAAwBI,UAAxB,EAAoCC,SAApC,EAA+CE,SAA/C,EAAyD;AAAA;;AACvDoE,SAAI3E,cAAc,GAAlB;AACA4E,kBAAa,CAACD,IAAI,CAAL,KAAWA,IAAI,CAAf,CAAb;AACAD,UAAK,IAAL;AACAD,YAAOrE,cAAc,EAArB;AACA,UAAKC,SAAL,GAAiBA,aAAa,GAA9B;AACA,UAAKE,SAAL,GAAiBA,aAAa,GAA9B;;AAGA,UAAKqF,CAAL,GAAS,IAAImB,KAAJ,CAAUnC,UAAV,EAAsBoC,IAAtB,CAA2B,CAA3B,CAAT;AACA,UAAKnB,CAAL,GAAS,IAAIkB,KAAJ,CAAUnC,UAAV,EAAsBoC,IAAtB,CAA2B,CAA3B,CAAT;AACA,UAAKhD,CAAL,GAAS,IAAI+C,KAAJ,CAAUnC,UAAV,EAAsBoC,IAAtB,CAA2B,CAA3B,CAAT;;AAEA,UAAKL,EAAL,GAAU,IAAII,KAAJ,CAAUnC,UAAV,EAAsBoC,IAAtB,CAA2B,CAA3B,CAAV;AACA,UAAKJ,EAAL,GAAU,IAAIG,KAAJ,CAAUnC,UAAV,EAAsBoC,IAAtB,CAA2B,CAA3B,CAAV;AACA,UAAKrB,EAAL,GAAU,IAAIoB,KAAJ,CAAUnC,UAAV,EAAsBoC,IAAtB,CAA2B,CAA3B,CAAV;AACD;;;;kCAEY3G,S,EAAU;AACrB,YAAKA,SAAL,GAAiBA,SAAjB;AACD;;;kCAEYE,S,EAAU;AACrB,YAAKA,SAAL,GAAiBA,SAAjB;AACD;;;iCAEW0G,Q,EAAS;AACnBvC,YAAKuC,QAAL;AACD;;;mCAEajH,U,EAAW;AACvB2E,WAAI3E,UAAJ;AACA4E,oBAAa,CAACD,IAAE,CAAH,KAASA,IAAE,CAAX,CAAb;AACD;;;mCAEavE,U,EAAW;AACvBqE,cAAOrE,UAAP;AACD;;;6BAEM;AACL,cAAOuE,CAAP;AACD;;;8BAEO;AACN,cAAOA,CAAP;AACD;;;gCAEUR,C,EAAGE,C,EAAE;AACd,cAAO,KAAKL,CAAL,CAAOe,GAAGZ,CAAH,EAAME,CAAN,CAAP,CAAP;AACD;;;gCAEUF,C,EAAGE,C,EAAGL,C,EAAE;AACjB,YAAKA,CAAL,CAAOe,GAAGZ,CAAH,EAAME,CAAN,CAAP,IAAmBL,CAAnB;AACD;;;8BAEO;AACJ,YAAI,IAAI1C,IAAI,CAAZ,EAAeA,IAAIsD,UAAnB,EAA+BtD,GAA/B;AACE,cAAKqF,EAAL,CAAQrF,CAAR,IAAa,KAAKsF,EAAL,CAAQtF,CAAR,IAAa,KAAKqE,EAAL,CAAQrE,CAAR,IAAa,GAAvC;AADF,QAGA,KAAKN,EAAL,CAAQ,uBAAa,KAAK2E,EAAlB,EAAsB,KAAKgB,EAA3B,EAA+B,KAAKC,EAApC,CAAR;AACAF,oBAAa,KAAKd,CAAlB,EAAqB,KAAKC,CAA1B,EAA6B,KAAKc,EAAlC,EAAsC,KAAKC,EAA3C,EAA+C,KAAKvG,SAApD;AACAoG,mBAAY,KAAKzC,CAAjB,EAAoB,KAAK2B,EAAzB,EAA6B,KAAKC,CAAlC,EAAqC,KAAKC,CAA1C,EAA6C,KAAKtF,SAAlD;AACH;;;2BAEK2G,Q,EAAU;AACZ,YAAKlG,EAAL,GAAUkG,QAAV;AACH;;;;;;mBAGUJ,W;;;;;;;;;;;;;;;;KC5MTK,Q;AACF,qBAAYnD,CAAZ,EAAe4B,CAAf,EAAkBC,CAAlB,EAAoB;AAAA;;AAClB,UAAK7B,CAAL,GAASA,CAAT;AACA,UAAK4B,CAAL,GAASA,CAAT;AACA,UAAKC,CAAL,GAASA,CAAT;AACA,UAAKuB,IAAL,GAAYnD,KAAKC,IAAL,CAAUF,EAAEqD,MAAZ,CAAZ;AACD;;;;wBAEE/F,C,EAAG0D,C,EAAE;AACN,cAAO1D,IAAI,KAAK8F,IAAL,GAAYpC,CAAvB;AACD;;;gCAEUb,C,EAAGE,C,EAAGL,C,EAAG;AACf,YAAKA,CAAL,CAAO,KAAKe,EAAL,CAAQZ,IAAI,CAAZ,EAAeE,IAAI,CAAnB,CAAP,IAAgCL,CAAhC;AACJ;;;gCAEUG,C,EAAGE,C,EAAG;AACZ,cAAO,KAAKL,CAAL,CAAO,KAAKe,EAAL,CAAQZ,IAAI,CAAZ,EAAeE,IAAI,CAAnB,CAAP,CAAP;AACJ;;;iCAEWF,C,EAAGE,C,EAAGiD,E,EAAIC,E,EAAI;AACxB,YAAK3B,CAAL,CAAO,KAAKb,EAAL,CAAQZ,IAAI,CAAZ,EAAeE,IAAI,CAAnB,CAAP,IAAgCiD,EAAhC;AACA,YAAKzB,CAAL,CAAO,KAAKd,EAAL,CAAQZ,IAAI,CAAZ,EAAeE,IAAI,CAAnB,CAAP,IAAgCkD,EAAhC;AACD;;;6BAEM;AACL,cAAO,KAAKH,IAAL,GAAY,CAAnB;AACD;;;8BAEO;AACN,cAAO,KAAKA,IAAL,GAAY,CAAnB;AACD;;;;;;mBAIUD,Q;;;;;;;;;;;;;;;;KCnCTK,gB;AACJ,6BAAYtG,MAAZ,EAAoBJ,MAApB,EAA2B;AAAA;;AACzB,UAAKA,MAAL,GAAcA,MAAd;AACA,UAAKI,MAAL,GAAcA,MAAd;AACA,UAAKuG,GAAL,GAAWvG,OAAOwG,UAAP,CAAkB,IAAlB,CAAX;AACA,UAAKC,SAAL,GAAiB,KAAKF,GAAL,CAASG,eAAT,CAAyB9G,OAAOnB,KAAP,EAAzB,EAAyCmB,OAAOhB,MAAP,EAAzC,CAAjB;;AAEA;AACA,UAAI,IAAIwB,IAAI,CAAZ,EAAeA,IAAI,KAAKqG,SAAL,CAAeE,IAAf,CAAoBR,MAAvC,EAA+C/F,KAAK,CAApD;AACE,YAAKqG,SAAL,CAAeE,IAAf,CAAoBvG,CAApB,IAAyB,GAAzB;AADF,MAGA,KAAKwG,OAAL;AACD;;;;+BAEQ;AACP,WAAIL,MAAM,KAAKvG,MAAL,CAAYwG,UAAZ,CAAuB,IAAvB,CAAV;AACAD,WAAIM,SAAJ;AACAN,WAAIO,IAAJ,CAAS,CAAT,EAAY,CAAZ,EAAe,KAAK9G,MAAL,CAAYvB,KAA3B,EAAkC,KAAKuB,MAAL,CAAYpB,MAA9C;AACA2H,WAAIQ,SAAJ,GAAgB,OAAhB;AACAR,WAAIT,IAAJ;AACAS,WAAIQ,SAAJ,GAAgB,MAAhB;AACAR,WAAIS,SAAJ,GAAgB,QAAhB;;AAEAT,WAAIU,IAAJ,GAAc,KAAKjH,MAAL,CAAYvB,KAAZ,GAAkB,EAAhC;AACA8H,WAAIW,QAAJ,CAAa,iBAAb,EAAgC,KAAKlH,MAAL,CAAYvB,KAAZ,GAAkB,CAAlD,EAAqD,KAAKuB,MAAL,CAAYpB,MAAZ,GAAmB,CAAxE;;AAEA,WAAIH,QAAQ,KAAKmB,MAAL,CAAYnB,KAAZ,EAAZ;AACA,WAAIG,SAAS,KAAKgB,MAAL,CAAYhB,MAAZ,EAAb;AACA,WAAI+H,OAAOJ,IAAIY,YAAJ,CAAiB,CAAjB,EAAoB,CAApB,EAAuB1I,KAAvB,EAA8BG,MAA9B,EAAsC+H,IAAjD;AACA,YAAI,IAAIS,QAAQ,CAAhB,EAAmBA,QAAQT,KAAKR,MAAhC,EAAwCiB,SAAO,CAA/C,EAAiD;AAC/C,aAAGT,KAAKS,KAAL,IAAc,EAAjB,EAAoB;AAClB,eAAIhH,IAAKgH,QAAQ,CAAT,GAAc3I,KAAd,GAAsB,CAA9B;AACA,eAAIqF,IAAKsD,QAAQ,CAAT,GAAc3I,KAAd,GAAsB,CAA9B;AACA,gBAAKmB,MAAL,CAAYyD,UAAZ,CAAuBjD,CAAvB,EAA0B0D,CAA1B,EAA6B,CAA7B;AACD;AACF;AAEF;;;8BAEO;AACN,WAAI6C,OAAO,KAAKF,SAAL,CAAeE,IAA1B;AACA,WAAI/H,SAAS,KAAKgB,MAAL,CAAYhB,MAAZ,EAAb;AACA,WAAIH,QAAQ,KAAKmB,MAAL,CAAYnB,KAAZ,EAAZ;;AAEA,YAAI,IAAI2B,IAAI,CAAZ,EAAeA,IAAI3B,KAAnB,EAA0B2B,GAA1B,EAA8B;AAC5B,cAAI,IAAI0D,IAAI,CAAZ,EAAeA,IAAIlF,MAAnB,EAA2BkF,GAA3B,EAA+B;AAC7B,eAAIsD,QAAQ,KAAKtD,IAAIlF,MAAJ,GAAawB,CAAlB,CAAZ;AACA;AACAuG,gBAAKS,QAAQ,CAAb,IAAkB,KAAKxH,MAAL,CAAYyH,UAAZ,CAAuBjH,CAAvB,EAA0B0D,CAA1B,IAA+B,GAA/B,GAAqC1D,CAArC,GAAyC3B,KAAzC,GAAiD,CAAnE;AACA;AACAkI,gBAAKS,QAAQ,CAAb,IAAkB,KAAKxH,MAAL,CAAYyH,UAAZ,CAAuBjH,CAAvB,EAA0B0D,CAA1B,IAA+B,GAA/B,GAAqCA,CAArC,GAAyCrF,KAAzC,GAAiD,CAAnE;AACA;AACAkI,gBAAKS,QAAQ,CAAb,IAAkB,KAAKxH,MAAL,CAAYyH,UAAZ,CAAuBjH,CAAvB,EAA0B0D,CAA1B,IAA+B,GAA/B,GAAqC,CAAvD;AACD;AACF;;AAED,YAAKyC,GAAL,CAASe,YAAT,CAAsB,KAAKb,SAA3B,EAAsC,CAAtC,EAAyC,CAAzC;AACD;;;;;;mBAIYH,gB","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap c2dc1e1f413e9b7a2aa2\n **/","import FluidSimulator from './fluidSimulator.js';\n\ndocument.addEventListener('DOMContentLoaded', function(){\n  let width = document.getElementById('fluidSimulator').offsetWidth;\n  let height = document.getElementById('fluidSimulator').offsetHeight;\n  let resolution = parseInt(document.getElementById('resolution').value);\n  let density = parseInt(document.getElementById('density').value);\n  let iterations = parseInt(document.getElementById('iterations').value);\n  let viscosity = parseFloat(document.getElementById('viscosity').value);\n  let diffusion = parseFloat(document.getElementById('diffusion').value);\n  let simulator = new FluidSimulator(width, height, resolution, density, diffusion, viscosity, iterations);\n});\n\n\n\n/** WEBPACK FOOTER **\n ** ./lib/entry.js\n **/","import FluidSolver from './fluidSolver.js';\nimport FluidBoxRenderer from './fluidBoxRenderer.js';\n\nclass FluidSimulator {\n\n  constructor(width, height, resolution, density, diffusion, viscosity, iterations){\n    this.width = width;\n    this.height = height;\n    this.resolution = resolution;\n    this.density = density || 90;\n\n    this.startPos = [0, 0];\n    this.currentPos = [0, 0];\n    this.mouseIsDown = false;\n    this.simulating = false;\n\n    this.solver = new FluidSolver(resolution, iterations, viscosity, diffusion);\n    this.solver.setUI(this.ui.bind(this));\n\n    this.canvas = this.initCanvas();\n    this.initControlPanel();\n    this.renderer = new FluidBoxRenderer(this.canvas, this.solver);\n\n    for(let i = 0; i < 20; i++)\n      this.update();\n  }\n\n  update(){\n    this.solver.update();\n    this.renderer.render();\n  }\n\n  initControlPanel(){\n    let $viscCtrl = $('#viscosity');\n    $viscCtrl.change( e => {\n      this.solver.setViscosity(parseFloat(e.target.value));\n    });\n\n    let $diffusionCtrl = $('#diffusion');\n    $diffusionCtrl.change( e => {\n      this.solver.setDiffusion(parseFloat(e.target.value));\n    });\n\n    let $resolutionCtrl = $('#resolution');\n    $resolutionCtrl.change( e => {\n      this.simulating = false;\n      this.resolution = parseInt(e.target.value);\n      this.solver = new FluidSolver(this.resolution);\n\n      this.solver.setUI(this.ui.bind(this));\n      this.canvas = this.initCanvas();\n      this.renderer = new FluidBoxRenderer(this.canvas, this.solver);\n    });\n\n    let $iterationsCtrl = $('#iterations');\n    $iterationsCtrl.change( e => {\n      this.solver.setIterations(parseInt(e.target.value));\n    });\n\n    let $densityCtrl = $('#density');\n    $densityCtrl.change( e => {\n      this.density = parseInt(e.target.value);\n    });\n\n  }\n\n  initCanvas(){\n    let canvas = $('#fluidSimulator').get(0);\n\n    canvas.width = canvas.height = this.resolution;\n    canvas.ontouchend = canvas.onmouseup = this.mouseUpHandler.bind(this);\n    canvas.ontouchstart = canvas.onmousedown = this.mouseDownHandler.bind(this);\n    canvas.ontouchmove = canvas.onmousemove = this.mouseMoveHandler.bind(this);\n\n    return canvas;\n  }\n\n  mouseDownHandler(e){\n    e.preventDefault();\n    this.startPos = this.currentPos = this.getMousePos(e);\n    this.mouseIsDown = true;\n\n    if(!this.simulating){\n      this.simulating = true;\n      setInterval(this.update.bind(this), 10);\n    }\n  }\n\n  mouseMoveHandler(e){\n    e.preventDefault();\n    this.currentPos = this.getMousePos(e);\n  }\n\n  mouseUpHandler(e){\n    e.preventDefault();\n    this.mouseIsDown = false;\n  }\n\n  getMousePos(e){\n    let posX = e.clientX - this.canvas.offsetLeft;\n    let posY = e.clientY - this.canvas.offsetTop;\n    return [posX, posY];\n  }\n\n  ui(fluidBox){\n    let startX = this.startPos[0];\n    let startY = this.startPos[1];\n    let currentX = this.currentPos[0];\n    let currentY = this.currentPos[1];\n\n    if(this.inCanvas(this.startPos) && this.mouseIsDown){\n      let dx = currentX - startX;\n      let dy = currentY - startY;\n      let d = Math.sqrt(dx * dx + dy * dy) || 0;\n\n      for(let i = 0; i < d; i++){\n        let x = Math.floor((startX + dx * (i / d)) * fluidBox.width() / this.width);\n        let y = Math.floor((startY + dy * (i / d)) * fluidBox.height() / this.height);\n\n        fluidBox.setVelocity(x, y, dx, dy);\n        fluidBox.setDensity(x, y, this.density);\n      }\n\n      this.startPos = [currentX, currentY];\n    }\n  }\n\n  inCanvas(pos){\n    return pos[0] >= 0 && pos[0] < this.width && pos[1] >= 0 && pos[1] < this.height;\n  }\n}\n\nexport default FluidSimulator;\n\n\n\n/** WEBPACK FOOTER **\n ** ./lib/fluidSimulator.js\n **/","import FluidBox from './fluidBox';\n\nlet iter = 10;\nlet dt = 0.1;\nlet N = 128;\nlet systemSize = (N+2) * (N+2);\n\nfunction addSource(x, s){\n    for(let i = 0; i < systemSize; i++) x[i] += dt * s[i];\n}\n\nfunction IX(i, j){\n  return i + (N + 2) * j;\n}\n\nfunction setBoundary(b, x){\n  for(let i = 1; i <= N ; i++){\n    x[IX(0, i)]    = b === 1 ? -x[IX(1, i)] : x[IX(1, i)];\n    x[IX(N+1, i)]  = b === 1 ? -x[IX(N, i)] : x[IX(N, i)];\n    x[IX(i, 0)]    = b === 2 ? -x[IX(i, 1)] : x[IX(i, 1)];\n    x[IX(i, N+1)]  = b === 2 ? -x[IX(i, N)] : x[IX(i, N)];\n  }\n\n  x[IX(0, 0)]     =   0.5 * (x[IX(1, 0)] + x[IX(0, 1)]);\n  x[IX(0, N+1)]   =   0.5 * (x[IX(1, N+1)] + x[IX(0, N)]);\n  x[IX(N+1, 0)]   =   0.5 * (x[IX(N, 0)] + x[IX(N+1, 1)]);\n  x[IX(N+1, N+1)] =   0.5 * (x[IX(N, N+1)] + x[IX(N+1, N)]);\n\n  return x;\n}\n\nfunction gaussSeidel(b, x, x0, diff){\n  let a = dt * diff;\n\n  for(let k = 0; k < iter; k++){\n    for(let i = 1; i <= N; i++){\n      for(let j = 1; j <= N; j++){\n        let neighborSum = x[IX(i-1, j)] + x[IX(i+1, j)] + x[IX(i, j-1)] + x[IX(i, j+1)];\n        x[IX(i, j)] = (x0[IX(i, j)] + a * neighborSum) / (1 + 4 * a);\n      }\n    }\n    setBoundary(b, x);\n  }\n}\n\nfunction diffuse(b, x, x0, diff){\n    gaussSeidel(b, x, x0, diff);\n}\n\nfunction advect(b, d, d0, u, v){\n  let x, y, s0, t0, s1, t1, i0, i1, j0, j1;\n\n  for(let i = 1; i <= N; i++){\n      for(let j = 1; j <= N; j++){\n          x = i - N * dt * u[IX(i, j)];\n          y = j - N * dt * v[IX(i, j)];\n\n          if (x < 0.5)\n              x = 0.5;\n          else if (x > N + 0.5)\n              x = N + 0.5;\n          i0 = Math.floor(x);\n          i1 = i0 + 1;\n\n          if (y < 0.5)\n              y = 0.5;\n          else if (y > N + 0.5)\n              y = N + 0.5;\n          j0 = Math.floor(y);\n          j1 = j0 + 1;\n\n          s1 = x - i0;\n          s0 = 1 - s1;\n          t1 = y - j0;\n          t0 = 1 - t1;\n\n          d[IX(i, j)] = s0 * (t0 * d0[IX(i0, j0)] + t1 * d0[IX(i0, j1)]) + s1 * (t0 * d0[IX(i1, j0)] + t1 * d0[IX(i1, j1)]);\n      }\n  }\n  setBoundary(b, d);\n}\n\nfunction project(u, v, p, div){\n    for(let j = 1; j <= N; j++){\n        for(let i = 1; i <= N; i++){\n          let neighborSum = u[IX(i+1, j)] - u[IX(i-1, j)] + v[IX(i, j+1)] - v[IX(i, j-1)];\n          div[IX(i, j)] = -0.5 * neighborSum / N;\n\n          p[IX(i, j)] = 0;\n        }\n    }\n    setBoundary(0, div);\n    setBoundary(0, p);\n\n    for(let k = 0; k < iter; k++){\n      for(let i = 1; i <= N; i++){\n        for(let j = 1; j <= N; j++){\n          let neighborSum = p[IX(i-1, j)] + p[IX(i+1, j)] + p[IX(i, j-1)] + p[IX(i, j+1)];\n          p[IX(i, j)] = (div[IX(i, j)] + neighborSum) / 4;\n        }\n      }\n      setBoundary(0, p);\n    }\n    setBoundary(0, p);\n\n    for(let j = 1; j <= N; j++){\n        for(let i = 1; i <= N; i++){\n            u[IX(i, j)] -= 0.5 * N * (p[IX(i+1, j)] - p[IX(i-1, j)]);\n            v[IX(i, j)] -= 0.5 * N * (p[IX(i, j+1)] - p[IX(i, j-1)]);\n        }\n    }\n    setBoundary(1, u);\n    setBoundary(2, v);\n}\n\nfunction densityStep(x, x0, u, v, diff){\n    addSource(x, x0);\n    diffuse(0, x0, x, diff);\n    advect(0, x, x0, u, v);\n}\n\nfunction velocityStep(u, v, u0, v0, visc){\n    addSource(u, u0);\n    addSource(v, v0);\n\n    diffuse(1, u0, u, visc);\n    diffuse(2, v0, v, visc);\n    project(u0, v0, u, v);\n\n    advect(1, u, u0, u0, v0);\n    advect(2, v, v0, u0, v0);\n    project(u, v, u0, v0);\n}\n\nclass FluidSolver {\n    constructor(resolution, iterations, viscosity, diffusion){\n      N = resolution || 128;\n      systemSize = (N + 2) * (N + 2);\n      dt = 0.08;\n      iter = iterations || 10;\n      this.viscosity = viscosity || 0.5;\n      this.diffusion = diffusion || 0.3;\n\n\n      this.u = new Array(systemSize).fill(0);\n      this.v = new Array(systemSize).fill(0);\n      this.d = new Array(systemSize).fill(0);\n\n      this.u0 = new Array(systemSize).fill(0);\n      this.v0 = new Array(systemSize).fill(0);\n      this.d0 = new Array(systemSize).fill(0);\n    }\n\n    setViscosity(viscosity){\n      this.viscosity = viscosity;\n    }\n\n    setDiffusion(diffusion){\n      this.diffusion = diffusion;\n    }\n\n    setTimeStep(timeStep){\n      dt = timeStep;\n    }\n\n    setResolution(resolution){\n      N = resolution;\n      systemSize = (N+2) * (N+2);\n    }\n\n    setIterations(iterations){\n      iter = iterations;\n    }\n\n    width(){\n      return N;\n    }\n\n    height(){\n      return N;\n    }\n\n    getDensity(x, y){\n      return this.d[IX(x, y)];\n    }\n\n    setDensity(x, y, d){\n      this.d[IX(x, y)] = d;\n    }\n\n    update(){\n        for(let i = 0; i < systemSize; i++)\n          this.u0[i] = this.v0[i] = this.d0[i] = 0.0;\n\n        this.ui(new FluidBox(this.d0, this.u0, this.v0));\n        velocityStep(this.u, this.v, this.u0, this.v0, this.viscosity);\n        densityStep(this.d, this.d0, this.u, this.v, this.diffusion);\n    }\n\n    setUI(callback) {\n        this.ui = callback;\n    }\n}\n\nexport default FluidSolver;\n\n\n\n/** WEBPACK FOOTER **\n ** ./lib/fluidSolver.js\n **/","class FluidBox {\n    constructor(d, u, v){\n      this.d = d;\n      this.u = u;\n      this.v = v;\n      this.size = Math.sqrt(d.length);\n    }\n\n    IX(i, j){\n      return i + this.size * j;\n    }\n\n    setDensity(x, y, d) {\n         this.d[this.IX(x + 1, y + 1)] = d;\n    }\n\n    getDensity(x, y) {\n         return this.d[this.IX(x + 1, y + 1)];\n    }\n\n    setVelocity(x, y, vX, vY) {\n      this.u[this.IX(x + 1, y + 1)] = vX;\n      this.v[this.IX(x + 1, y + 1)] = vY;\n    }\n\n    width(){\n      return this.size - 2;\n    }\n\n    height(){\n      return this.size - 2;\n    }\n}\n\n\nexport default FluidBox;\n\n\n\n/** WEBPACK FOOTER **\n ** ./lib/fluidBox.js\n **/","class FluidBoxRenderer {\n  constructor(canvas, solver){\n    this.solver = solver;\n    this.canvas = canvas;\n    this.ctx = canvas.getContext('2d');\n    this.imageData = this.ctx.createImageData(solver.width(), solver.height());\n\n    // set image data to alpha to 255\n    for(let i = 3; i < this.imageData.data.length; i += 4)\n      this.imageData.data[i] = 255;\n\n    this.densify();\n  }\n\n  densify(){\n    let ctx = this.canvas.getContext('2d');\n    ctx.beginPath();\n    ctx.rect(0, 0, this.canvas.width, this.canvas.height);\n    ctx.fillStyle = \"black\";\n    ctx.fill();\n    ctx.fillStyle = 'gray';\n    ctx.textAlign = 'center';\n\n    ctx.font = `${this.canvas.width/12}px Courier New`;\n    ctx.fillText('Click and Drag!', this.canvas.width/2, this.canvas.height/2);\n\n    let width = this.solver.width();\n    let height = this.solver.height();\n    let data = ctx.getImageData(0, 0, width, height).data;\n    for(let pixel = 0; pixel < data.length; pixel+=4){\n      if(data[pixel] > 10){\n        let i = (pixel / 4) % width | 0;\n        let j = (pixel / 4) / width | 0;\n        this.solver.setDensity(i, j, 5);\n      }\n    }\n\n  }\n\n  render(){\n    let data = this.imageData.data;\n    let height = this.solver.height();\n    let width = this.solver.width();\n\n    for(let i = 0; i < width; i++){\n      for(let j = 0; j < height; j++){\n        let pixel = 4 * (j * height + i);\n        // red\n        data[pixel + 0] = this.solver.getDensity(i, j) * 255 * i / width / 5;\n        // green\n        data[pixel + 1] = this.solver.getDensity(i, j) * 255 * j / width / 5;\n        // blue\n        data[pixel + 2] = this.solver.getDensity(i, j) * 255 / 5;\n      }\n    }\n\n    this.ctx.putImageData(this.imageData, 0, 0);\n  }\n\n}\n\nexport default FluidBoxRenderer;\n\n\n\n/** WEBPACK FOOTER **\n ** ./lib/fluidBoxRenderer.js\n **/"],"sourceRoot":""}